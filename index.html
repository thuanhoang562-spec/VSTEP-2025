<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VSTEP AI Grader: Say Hi Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* --- 1. GIAO DI·ªÜN CHUNG --- */
        :root {
            --neon-orange: #ff9f43;
            --neon-blue: #0abde3;
            --neon-green: #1dd1a1;
            --dark-bg: #222f3e;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Montserrat', sans-serif; }
        body { height: 100vh; background: #000; overflow: hidden; }

        /* --- 2. M√ÄN H√åNH CH√ÄO --- */
        #welcome-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, #1e272e, #000);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 9999; transition: opacity 0.8s ease;
        }
        .welcome-title {
            font-size: 3.5rem; font-weight: 900; text-transform: uppercase;
            background: linear-gradient(45deg, var(--neon-orange), var(--neon-blue));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            margin-bottom: 20px; text-shadow: 0 0 20px rgba(255, 159, 67, 0.5);
        }
        .btn-start {
            padding: 15px 40px; font-size: 1.2rem; font-weight: 800; color: #fff;
            background: var(--neon-orange); border: none; border-radius: 50px; cursor: pointer;
            box-shadow: 0 0 20px rgba(255, 159, 67, 0.6); animation: pulse 2s infinite;
        }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(255, 159, 67, 0.7); } 70% { box-shadow: 0 0 0 20px rgba(0,0,0,0); } 100% { box-shadow: 0 0 0 0 rgba(0,0,0,0); } }

        /* --- 3. GIAO DI·ªÜN CH√çNH --- */
        #app-interface {
            display: none; width: 100%; height: 100%;
            background: url('https://source.unsplash.com/1920x1080/?concert,stage,neon') no-repeat center center/cover;
            justify-content: center; align-items: center; opacity: 0; transition: opacity 1s ease;
        }
        .container {
            width: 95%; max-width: 1400px; height: 90vh;
            background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(15px);
            border-radius: 20px; display: grid; grid-template-columns: 260px 1fr 320px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5); overflow: hidden;
        }

        /* SIDEBAR */
        .sidebar { padding: 20px; background: rgba(240, 240, 240, 0.8); overflow-y: auto; }
        .logo-text { font-size: 1.2rem; font-weight: 800; color: var(--dark-bg); margin-bottom: 20px; text-align: center; border-bottom: 3px solid var(--neon-orange); padding-bottom: 10px; }
        .menu-group { font-size: 0.8rem; font-weight: 700; color: #888; margin: 15px 0 5px 5px; text-transform: uppercase; }
        .menu-btn { display: block; width: 100%; padding: 10px 15px; margin-bottom: 5px; text-align: left; border: none; background: transparent; border-radius: 10px; cursor: pointer; font-weight: 600; color: #333; transition: 0.2s; }
        .menu-btn:hover, .menu-btn.active { background: linear-gradient(45deg, var(--neon-orange), var(--neon-blue)); color: white; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }

        /* MAIN CONTENT */
        .main-content { padding: 30px; overflow-y: auto; background: white; }
        .lesson-title { font-size: 1.8rem; font-weight: 800; margin-bottom: 20px; color: var(--dark-bg); }
        
        /* CARD C√ÇU H·ªéI */
        .qa-card {
            background: #fdfdfd; border: 1px solid #eee; border-radius: 16px;
            padding: 25px; margin-bottom: 30px; box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            border-left: 5px solid var(--neon-blue);
        }
        .question { font-size: 1.1rem; font-weight: 700; margin-bottom: 15px; color: #2d3436; }

        /* KHUNG NH·∫¨P LI·ªÜU C·ª¶A NG∆Ø·ªúI D√ôNG */
        .user-input-area { margin-bottom: 15px; }
        textarea {
            width: 100%; height: 100px; padding: 15px; border-radius: 10px;
            border: 2px solid #dfe6e9; font-size: 1rem; color: #333; outline: none;
            transition: 0.3s; resize: vertical; font-family: 'Montserrat', sans-serif;
        }
        textarea:focus { border-color: var(--neon-blue); background: #f0fbff; }
        
        .btn-grade {
            background: var(--neon-blue); color: white; padding: 10px 25px;
            border: none; border-radius: 30px; font-weight: 700; cursor: pointer;
            margin-right: 10px; transition: 0.2s;
        }
        .btn-grade:hover { transform: translateY(-2px); box-shadow: 0 4px 10px rgba(10, 189, 227, 0.4); }
        
        .btn-toggle {
            background: #eee; color: #555; padding: 10px 25px;
            border: none; border-radius: 30px; font-weight: 600; cursor: pointer;
        }

        /* KHUNG K·∫æT QU·∫¢ CH·∫§M ƒêI·ªÇM */
        .grading-result {
            margin-top: 15px; padding: 15px; border-radius: 10px; background: #fff3cd;
            display: none; animation: fadeIn 0.5s; border: 1px dashed #ffa502;
        }
        .score-display { font-size: 1.2rem; font-weight: 800; color: #e67e22; margin-bottom: 5px; }
        .feedback-text { font-size: 0.95rem; color: #555; line-height: 1.5; }
        .missing-keywords { color: #d63031; font-weight: 600; }

        /* ƒê√ÅP √ÅN M·∫™U */
        .answer {
            margin-top: 20px; padding: 20px; background: #f8f9fa; border-radius: 12px;
            display: none; line-height: 1.8; color: #333; white-space: pre-wrap;
            border: 1px dashed #ccc;
        }
        .answer.show { display: block; animation: slideDown 0.4s; }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

        /* WIDGETS */
        .widgets { padding: 20px; background: rgba(240, 240, 240, 0.8); display: flex; flex-direction: column; gap: 20px; }
        .timer-box { background: white; padding: 20px; border-radius: 16px; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .time-text { font-size: 3rem; font-weight: 800; color: var(--neon-orange); }
        .spotify-box { flex-grow: 1; border-radius: 16px; overflow: hidden; background: black; }

        @media (max-width: 900px) {
            .container { grid-template-columns: 1fr; height: auto; min-height: 100vh; }
            .sidebar, .widgets { display: none; }
        }
    </style>
</head>
<body>

    <div id="welcome-screen">
        <div class="welcome-title">SAY HI & STUDY</div>
        <p style="color: #ccc; margin-bottom: 30px;">Luy·ªán thi VSTEP - T·ª± ƒë·ªông ch·∫•m ƒëi·ªÉm t·ª´ kh√≥a</p>
        <button class="btn-start" onclick="enterApp()">V√ÄO H·ªåC NGAY üöÄ</button>
    </div>

    <div id="app-interface">
        <div class="container">
            <div class="sidebar">
    <div class="logo-text">DANH S√ÅCH B√ÄI H·ªåC</div>
    
    <div class="menu-group">Speaking Part 1</div>
    <button class="menu-btn active" onclick="loadLesson('sp1_hobbies', this)">1. Hobbies & Interests</button>
    <button class="menu-btn" onclick="loadLesson('sp1_family', this)">2. Family</button>
    <button class="menu-btn" onclick="loadLesson('sp1_transport', this)">3. Transport</button>
    <button class="menu-btn" onclick="loadLesson('sp1_food', this)">4. Food</button>
    <button class="menu-btn" onclick="loadLesson('sp1_housing', this)">5. Housing</button>
    <button class="menu-btn" onclick="loadLesson('sp1_festivals', this)">6. Festivals</button>
    <button class="menu-btn" onclick="loadLesson('sp1_communication', this)">7. Communication</button>

    <div class="menu-group">Speaking Part 2 (Choices)</div>
    <button class="menu-btn" onclick="loadLesson('sp2_relax', this)">1. Relaxing Weekend</button>
    <button class="menu-btn" onclick="loadLesson('sp2_gift', this)">2. Birthday Gift</button>
    <button class="menu-btn" onclick="loadLesson('sp2_trip', this)">3. Planning a Trip</button>
    <button class="menu-btn" onclick="loadLesson('sp2_info', this)">4. Finding Information</button>
    <button class="menu-btn" onclick="loadLesson('sp2_watch', this)">5. Buying a Watch</button>
    <button class="menu-btn" onclick="loadLesson('sp2_job', this)">6. Finding Job Info</button>
    <button class="menu-btn" onclick="loadLesson('sp2_contact', this)">7. Contacting Friend</button>
    <button class="menu-btn" onclick="loadLesson('sp2_speaker', this)">8. Inviting Speaker</button>

    <div class="menu-group">Speaking Part 3</div>
    <button class="menu-btn" onclick="loadLesson('sp3_zoos', this)">1. Animals in Zoos</button>
    <button class="menu-btn" onclick="loadLesson('sp3_reading', this)">2. Reading Habits</button>
    <button class="menu-btn" onclick="loadLesson('sp3_city', this)">3. Living in City</button>
    <button class="menu-btn" onclick="loadLesson('sp3_housework', this)">4. Children & Housework</button>
    <button class="menu-btn" onclick="loadLesson('sp3_kindergarten', this)">5. Kindergarten Age</button>
    <button class="menu-btn" onclick="loadLesson('sp3_uniforms', this)">6. School Uniforms</button>

    <div class="menu-group">Writing Task 1 (Letters)</div>
    <button class="menu-btn" onclick="loadLesson('wt1_aldora', this)">1. Visit London (Friend)</button>
    <button class="menu-btn" onclick="loadLesson('wt1_complaint_gym', this)">2. Complaint Sports Center</button>
    <button class="menu-btn" onclick="loadLesson('wt1_job_admin', this)">3. Job App (Admin)</button>
    <button class="menu-btn" onclick="loadLesson('wt1_job_more', this)">4. Job Info (Ms. Julie)</button>
    <button class="menu-btn" onclick="loadLesson('wt1_roommate', this)">5. Complaint Roommate</button>
    <button class="menu-btn" onclick="loadLesson('wt1_restaurant', this)">6. Complaint Restaurant</button>
    <button class="menu-btn" onclick="loadLesson('wt1_laptop', this)">7. Apology (Laptop)</button>
    <button class="menu-btn" onclick="loadLesson('wt1_wallet', this)">8. Thank you (Wallet)</button>
    <button class="menu-btn" onclick="loadLesson('wt1_course', this)">9. Request Course Info</button>
    <button class="menu-btn" onclick="loadLesson('wt1_susie', this)">10. New Job (Friend)</button>

    <div class="menu-group">Writing Task 2 (Essays)</div>
    <button class="menu-btn" onclick="loadLesson('wt2_online', this)">1. Online Learning</button>
    <button class="menu-btn" onclick="loadLesson('wt2_internet', this)">2. The Internet</button>
    <button class="menu-btn" onclick="loadLesson('wt2_famous', this)">3. Being Famous</button>
    <button class="menu-btn" onclick="loadLesson('wt2_homeschool', this)">4. Homeschooling</button>
    <button class="menu-btn" onclick="loadLesson('wt2_extra', this)">5. Extracurricular</button>
    <button class="menu-btn" onclick="loadLesson('wt2_ads', this)">6. Advertising</button>
    <button class="menu-btn" onclick="loadLesson('wt2_transport', this)">7. Public Transport</button>
    <button class="menu-btn" onclick="loadLesson('wt2_multitask', this)">8. Multitasking</button>
    <button class="menu-btn" onclick="loadLesson('wt2_abroad', this)">9. Studying Abroad</button>
    <button class="menu-btn" onclick="loadLesson('wt2_attendance', this)">10. Uni Attendance</button>
    <button class="menu-btn" onclick="loadLesson('wt2_smoking', this)">11. Smoking Ban</button>
    <button class="menu-btn" onclick="loadLesson('wt2_salary', this)">12. Job Satisfaction vs Salary</button>
    <button class="menu-btn" onclick="loadLesson('wt2_single', this)">13. Single Life</button>
    <button class="menu-btn" onclick="loadLesson('wt2_childbirth', this)">14. Delaying Childbirth</button>
    <button class="menu-btn" onclick="loadLesson('wt2_stress', this)">15. Stress</button>
    <button class="menu-btn" onclick="loadLesson('wt2_obesity', this)">16. Obesity</button>
    <button class="menu-btn" onclick="loadLesson('wt2_brain', this)">17. Brain Drain</button>
    <button class="menu-btn" onclick="loadLesson('wt2_traffic', this)">18. Traffic Problems</button>
    <button class="menu-btn" onclick="loadLesson('wt2_softskills', this)">19. Soft Skills</button>
</div>

            <div class="main-content" id="lesson-content">
                </div>

            <div class="widgets">
                <div class="timer-box">
                    <h4 style="color: #555;">TIMER</h4>
                    <div class="time-text" id="timer">25:00</div>
                    <button style="padding:5px 10px; cursor:pointer;" onclick="startTimer()">Start</button>
                    <button style="padding:5px 10px; cursor:pointer;" onclick="resetTimer()">Reset</button>
                </div>
                <div class="spotify-box">
                    <iframe style="border-radius:12px" src="https://open.spotify.com/embed/playlist/37i9dQZF1DX4g8Gs5nUhpp?utm_source=generator" width="100%" height="100%" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- 1. D·ªÆ LI·ªÜU B√ÄI H·ªåC (FULL SCRIPT) ---
       const lessons = {
    // --- SPEAKING PART 1 ---
    'sp1_hobbies': {
        title: "Speaking Part 1: Hobbies [cite: 3486]",
        qa: [
            { q: "What do you often do in your free time?", a: "I often read books in my free time. That's because it's fun and interesting. It makes me feel good and gives me energy. So, It helps to reduce my stress. Also, it's a good way to kill time. [cite: 3488-3490]" },
            { q: "Do you play sports?", a: "Yes, I do. I often play badminton. That's because it's fun and interesting. It makes me feel good and gives me energy. Also, it's a good way to kill time. Actually, I usually play badminton with my best friend, Phuong. [cite: 3493-3495]" },
            { q: "Do you watch TV?", a: "Yes, I do. I often watch TV after dinner with my family. We watch our favorite TV shows together. [cite: 3500]" }
        ]
    },
    'sp1_family': {
        title: "Speaking Part 1: Family [cite: 3432]",
        qa: [
            { q: "Who never cooks in your family?", a: "Actually, I never cook in the family. This is because I'm too busy with my work and I hardly have time to do other things. So, my mom often cooks for me and my family. [cite: 3425-3426]" },
            { q: "Tell me about your family.", a: "There are 4 people in my family: my parents, me and my sister. My parents are farmers. My sister and I are university students. I like talking with my mom. She is very patient to me and she often gives me helpful advice. [cite: 3433-3435]" }
        ]
    },
    'sp1_transport': {
        title: "Speaking Part 1: Transport [cite: 4770]",
        qa: [
            { q: "How do you usually get to and from work/college?", a: "I usually get to and from college by motorbike. Because my house is near my school, it takes me only 10 minutes to go to school by motorbike. ALSO, my area doesn't have public transport. [cite: 4772-4773]" },
            { q: "How often do you take taxis?", a: "I never take a taxi. That's because it's a waste of money. It costs a lot of money to go by taxi. Since I'm a university student, I live on a tight budget. [cite: 4782-4784]" }
        ]
    },
    'sp1_food': {
        title: "Speaking Part 1: Food [cite: 3720]",
        qa: [
            { q: "What food do you like best?", a: "Well, I like Banh Loc best - which is the traditional food of my hometown, Hue. And it's very popular with tourists too. [cite: 3728-3729]" },
            { q: "What do you usually have for breakfast?", a: "I usually have bread for breakfast. That's because it is easy to eat and it's also very delicious. Moreover, it's convenient to buy bread because people sell bread a lot on the streets. [cite: 3730-3731]" },
            { q: "How often do you eat out?", a: "I eat out at restaurants once or twice a month. Sometimes my mom is too busy to cook for the family, so my family will eat at the restaurant instead. [cite: 3737-3738]" }
        ]
    },
    'sp1_housing': {
        title: "Speaking Part 1: Houses [cite: 3896]",
        qa: [
            { q: "Do you live in a house or a flat?", a: "I live in a house. It's an old house and I have been living there for over 10 years. [cite: 3903]" },
            { q: "Who do you live with?", a: "I live with my family: my parents, me and my sister. By living in the same house, we can easily take care of each other. [cite: 3904-3905]" },
            { q: "What is your favorite room?", a: "My favorite room is my bedroom. This is because I spend most of my time in my room. I study and sometimes I eat in my room as well. [cite: 3908-3909]" }
        ]
    },
    'sp1_festivals': {
        title: "Speaking Part 1: Festivals [cite: 4154]",
        qa: [
            { q: "What's your favorite festival?", a: "My favorite festival is the Hue Traditional Food Festival. I go there every year with my friends to enjoy delicious food. There are also many entertaining performances. [cite: 4167-4169]" },
            { q: "How did you last celebrate your birthday?", a: "I last celebrated my birthday party in September. I invited my family and some friends to a restaurant. We had a meal together and then we sang karaoke. [cite: 4175-4177]" }
        ]
    },
    'sp1_communication': {
        title: "Speaking Part 1: Communications [cite: 4840]",
        qa: [
            { q: "How do you usually keep in touch with family?", a: "I usually keep in touch with my family by phone or through social media platforms, like facebook, messenger and zalo. We often make video calls or just send some text messages. [cite: 4853-4855]" },
            { q: "Do you prefer to write by hand or on a computer?", a: "I prefer to write on a computer because it has some benefits. Firstly, it's convenient. It doesn't take a long time and it's also easy to carry around. Secondly, it saves money because I don't have to buy paper. [cite: 4860-4862]" }
        ]
    },

    // --- SPEAKING PART 2 ---
    'sp2_relax': {
        title: "Part 2: Relaxing Weekend [cite: 5546]",
        qa: [
            { q: "Choices: Watching TV, Trip, Hanging out in Cafe. What is best?", a: "I believe that hanging out with friends in a caf√© is the best choice. First, it is good and suitable. In addition, it's fun and interesting. It helps to reduce stress. Finally, it saves money. A cup of coffee is cheap (~25k VND). Watching TV is boring and going on a trip is expensive/time-consuming. [cite: 5550-5563]" }
        ]
    },
    'sp2_gift': {
        title: "Part 2: Birthday Gift [cite: 5654]",
        qa: [
            { q: "Choices: Clothing, Book, Movie tickets. What is best?", a: "I believe that a book is the best choice. First, it is good and suitable. My friend loves reading books. It's fun and interesting. Also, it saves money (~50k VND). Movie tickets are not useful if she doesn't like movies, and clothing takes time to choose. [cite: 5658-5668]" }
        ]
    },
    'sp2_trip': {
        title: "Part 2: Trip Planning (Summer) [cite: 5629]",
        qa: [
            { q: "Choices: Seaside resort, Lakeside hotel, Countryside cottage. What is best?", a: "I believe that a seaside resort is the best choice. It's fun and interesting. We can lie on the sand, enjoy the sunlight, and watch the sunset. It helps reduce stress. The other options are boring or inconvenient. [cite: 5633-5644]" }
        ]
    },
    'sp2_info': {
        title: "Part 2: Finding Information [cite: 5671]",
        qa: [
            { q: "Choices: Asking someone, Using Google, Reading magazine. What is best?", a: "I believe using a search engine like Google is the best choice. It saves money (free) and saves time. There is a lot of information online. Buying magazines is a waste of money and asking people is inconvenient. [cite: 5676-5692]" }
        ]
    },
    'sp2_watch': {
        title: "Part 2: Buying a Watch [cite: 5698]",
        qa: [
            { q: "Choices: Website order, Mall, Phone. What is best?", a: "I believe placing an order through a website is the best choice. It saves money (vouchers/coupons) and saves time. Shopping in a mall is time-consuming and calling over the phone is uncomfortable. [cite: 5702-5713]" }
        ]
    },
    'sp2_job': {
        title: "Part 2: Finding Job Info [cite: 5716]",
        qa: [
            { q: "Choices: Person doing job, Internet, Newspaper. What is best?", a: "I believe finding information on the Internet is best. It saves money (free) and saves time. Buying newspapers costs money and finding a person is inconvenient. [cite: 5720-5738]" }
        ]
    },
    'sp2_contact': {
        title: "Part 2: Contacting Friend [cite: 5741]",
        qa: [
            { q: "Choices: Email, Post mail, Postcard. What is best?", a: "I believe an email is the best choice. It saves money (free) and saves time (instant). Post mail or postcards are expensive and time-consuming (2-3 days). [cite: 5744-5760]" }
        ]
    },
    'sp2_speaker': {
        title: "Part 2: Inviting Speaker [cite: 6802]",
        qa: [
            { q: "Choices: Famous singer, Company president, Excellent student. Who is best?", a: "I believe inviting a company president is the best choice. The president has life experience to share, helping us learn skills like problem-solving. Singers are expensive (>5 million VND) and students lack experience. [cite: 6806-6814]" }
        ]
    },

    // --- SPEAKING PART 3 ---
    'sp3_zoos': {
        title: "Part 3: Animals in Zoos [cite: 3458]", // Note: Topic from text content
        qa: [
            { q: "Disadvantages of keeping animals in zoos?", a: "1. Animals lack survival skills (fed by humans).\n2. Lack living space (cages are small).\n3. Lose freedom. [cite: 6821-6827]" },
            { q: "Benefits of zoos?", a: "1. Keep animals safe/protect endangered species.\n2. Make money from tickets.\n3. Teach children knowledge about animals. [cite: 6829-6833]" }
        ]
    },
    'sp3_reading': {
        title: "Part 3: Reading Habits [cite: 3450]",
        qa: [
            { q: "Why should reading be encouraged?", a: "1. Reduce stress (fun/interesting).\n2. Increase knowledge (e.g., history).\n3. Improve memory. [cite: 3451-3456]" }
        ]
    },
    'sp3_city': {
        title: "Part 3: Living in the City [cite: 3519]",
        qa: [
            { q: "Benefits of living in the city?", a: "1. More chances for good jobs (international companies).\n2. Better education (universities).\n3. Higher quality healthcare (big hospitals). [cite: 3520-3525]" }
        ]
    },
    'sp3_housework': {
        title: "Part 3: Children & Housework [cite: 4106]",
        qa: [
            { q: "Why teach children housework?", a: "1. Keep close family relationship (do together).\n2. Teach teamwork.\n3. Improve planning/life skills. [cite: 4109-4116]" }
        ]
    },
    'sp3_kindergarten': {
        title: "Part 3: Kindergarten Age [cite: 4130]",
        qa: [
            { q: "Why start kindergarten by 4?", a: "1. Learn to be independent (shower, brush teeth).\n2. Get used to new communities/make friends.\n3. Build good studying habits. [cite: 4132-4139]" }
        ]
    },
    'sp3_uniforms': {
        title: "Part 3: School Uniforms [cite: 4142]",
        qa: [
            { q: "Why wear uniforms?", a: "1. Save parents' money (only buy 2-3 sets).\n2. Save time (don't have to think what to wear).\n3. Break class barriers. [cite: 4144-4150]" }
        ]
    },

    // --- WRITING TASK 1 (LETTERS) ---
    'wt1_aldora': {
        title: "Task 1: Letter to Aldora [cite: 3536]",
        qa: [
            { q: "Letter to friend about visiting London.", a: "Dear Aldora,\nThanks for your email. I'm excited to see you in London.\nFirstly, my flight arrives at 9 am on Oct 25th. I'm happy you can pick me up.\nI haven't been to London before. I want to visit Big Ben and try traditional food.\nSee you soon,\n[Name] [cite: 3549-3558]" }
        ]
    },
    'wt1_complaint_gym': {
        title: "Task 1: Complaint Sports Center [cite: 3563]",
        qa: [
            { q: "Complaint to manager about service.", a: "Dear Mr. Smith,\nI am writing to give opinions to improve your center.\nGood points: Near my house, modern equipment.\nBad points: Changing room takes too long to wait.\nSuggestion: More changing rooms and new yoga equipment.\nBest regards, [cite: 3576-3585]" }
        ]
    },
    'wt1_job_admin': {
        title: "Task 1: Job Application (Admin) [cite: 3748]",
        qa: [
            { q: "Apply for Admin Executive position.", a: "Dear Sir/Madam,\nI am writing to apply for the admin executive position. I enclosed my CV.\nI graduated from Hue University of Economics in 2019. I have 2 years experience as HR staff. I am proficient in English (B2). I hope to be contacted for an interview.\nBest Regards, [cite: 3749-3758]" }
        ]
    },
    'wt1_job_more': {
        title: "Task 1: More Job Info [cite: 3788]",
        qa: [
            { q: "Reply to Ms. Julie with more info.", a: "Dear Ms. Julie,\nI am writing to give more info.\n1. Why this org: It is the best in the area.\n2. Why me: Hue University graduate, 3 years experience at Simons Center.\n3. Preference: Floral Campus (near city center).\nBest Regards, [cite: 3789-3798]" }
        ]
    },
    'wt1_roommate': {
        title: "Task 1: Complaint Roommate [cite: 3801]",
        qa: [
            { q: "Complaint about roommate in college.", a: "Dear Sir/Madam,\nI am writing to complain about my room (303). My roommate Miley always has parties and is noisy. She borrows things without asking. I want a single room next term to concentrate on study.\nBest Regards, [cite: 3802-3813]" }
        ]
    },
    'wt1_restaurant': {
        title: "Task 1: Complaint Restaurant [cite: 3821]",
        qa: [
            { q: "Complaint about bad dinner experience.", a: "Dear Sir/Madam,\nI am writing to complain about last Wednesday. We waited 30 mins for a table. The waiter was unfriendly. The food was cold and bad. We got stomachaches. I request a full refund.\nBest Regards, [cite: 3822-3831]" }
        ]
    },
    'wt1_laptop': {
        title: "Task 1: Apology (Laptop) [cite: 3927]",
        qa: [
            { q: "Apologize for damaging friend's laptop.", a: "Dear Simon,\nI'm sorry I damaged your laptop. I spilled coffee on it at a cafe. I took it to a repair shop, they need 5 days. I will return it this Sunday. Let's meet then, I want to make it up to you.\nAll the best, [cite: 3944-3955]" }
        ]
    },
    'wt1_wallet': {
        title: "Task 1: Thank you (Wallet) [cite: 3961]",
        qa: [
            { q: "Thank someone for finding wallet.", a: "Dear Mr. Smith,\nThank you for finding my wallet. I lost it at Vincom Mall. I was sad because it had important documents. Could you give me your address to pick it up? Or we can meet at a coffee shop.\nBest Regards, [cite: 3979-3988]" }
        ]
    },
    'wt1_course': {
        title: "Task 1: Request Course Info [cite: 4023]",
        qa: [
            { q: "Ask about English course (B1).", a: "Dear Sir/Madam,\nI want to register for your B1 class. My friend recommended it. How much is the tuition? How long does it last? I want to take the test in May.\nBest Regards, [cite: 4027-4036]" }
        ]
    },
    'wt1_susie': {
        title: "Task 1: Letter to Susie (New Job) [cite: 4063]",
        qa: [
            { q: "Tell friend about new job.", a: "Dear Susie,\nI started a new job! I quit the old HR job because it was too heavy. Now I work in marketing near my house. Good salary, friendly coworkers. Also, I will visit you in Danang this weekend!\nAll the best, [cite: 4086-4099]" }
        ]
    },

    // --- WRITING TASK 2 (ESSAYS) ---
    'wt2_online': {
        title: "Task 2: Online Learning [cite: 4207]",
        qa: [
            { q: "Advantages/Disadvantages of Online Learning.", a: "Positives: Convenient (anywhere/anytime), suitable for working students.\nNegatives: Difficult to focus (distractions at home), lazy without teacher supervision.\nConclusion: Consider both sides. [cite: 4216-4233]" }
        ]
    },
    'wt2_internet': {
        title: "Task 2: The Internet [cite: 4263]",
        qa: [
            { q: "Advantages/Disadvantages of Internet.", a: "Positives: Convenient, saves time/money, access anywhere.\nNegatives: Health problems, game addiction (bad for school performance).\nConclusion: Use wisely. [cite: 4270-4286]" }
        ]
    },
    'wt2_famous': {
        title: "Task 2: Being Famous [cite: 4330]",
        qa: [
            { q: "Pros/Cons of Being Famous.", a: "Pros: Gain a lot of money (e.g., Son Tung M-TP).\nCons: No private life (paparazzi, anti-fans), life in danger.\nConclusion: Consider carefully. [cite: 4339-4354]" }
        ]
    },
    'wt2_homeschool': {
        title: "Task 2: Homeschooling [cite: 4381]",
        qa: [
            { q: "Pros/Cons of Homeschooling.", a: "Pros: Convenient, focus on subjects children like -> become good at them.\nCons: Reduce social interactions, no friends/social activities.\nConclusion: Consider pros and cons. [cite: 4390-4404]" }
        ]
    },
    'wt2_extra': {
        title: "Task 2: Extracurricular Activities [cite: 4430]",
        qa: [
            { q: "Pros/Cons of Extracurriculars.", a: "Pros: Reduce stress, improve health/social skills.\nCons: Waste of time, less time for study, affect academic performance.\nConclusion: Balance is needed. [cite: 4438-4451]" }
        ]
    },
    'wt2_ads': {
        title: "Task 2: Advertising [cite: 4479]",
        qa: [
            { q: "Pros/Cons of Advertising.", a: "Pros: Promote sales (e.g., Coca Cola).\nCons: Very pricey (thousands of dollars), waste of money if products don't sell.\nConclusion: Consider carefully. [cite: 4488-4502]" }
        ]
    },
    'wt2_transport': {
        title: "Task 2: Public Transport [cite: 4528]",
        qa: [
            { q: "Pros/Cons of Public Transport.", a: "Pros: Convenient (listen to music), saves money (cheap tickets), protects environment.\nCons: Uncomfortable, traffic jams, bad quality seats.\nConclusion: Mixed benefits. [cite: 4537-4553]" }
        ]
    },
    'wt2_multitask': {
        title: "Task 2: Multitasking [cite: 4583]",
        qa: [
            { q: "Pros/Cons of Multitasking.", a: "Pros: Save time, increase productivity (good for tight schedules).\nCons: Cause stress, decrease quality (can't focus).\nConclusion: Consider carefully. [cite: 4591-4605]" }
        ]
    },
    'wt2_abroad': {
        title: "Task 2: Studying Abroad [cite: 4683]",
        qa: [
            { q: "Pros/Cons of Studying Abroad.", a: "Pros: Learn language, experience culture, better job opportunities (high salary).\nCons: Culture shock, language barrier, homesickness.\nConclusion: Weigh benefits vs difficulties. [cite: 4691-4709]" }
        ]
    },
    'wt2_attendance': {
        title: "Task 2: University Attendance [cite: 4956]",
        qa: [
            { q: "Should class attendance be optional?", a: "Agree partially. Required for important subjects (future career). Optional for unimportant ones (freedom to decide).\nConclusion: Balance required vs optional. [cite: 4975-4992]" }
        ]
    },
    'wt2_smoking': {
        title: "Task 2: Smoking Ban [cite: 5071]",
        qa: [
            { q: "Should smoking be banned in public?", a: "Yes. 1. Bad for others' health (second-hand smoke, cancer). 2. Causes pollution (trash). 3. Sets bad example for children.\nConclusion: Ban it. [cite: 5080-5109]" }
        ]
    },
    'wt2_salary': {
        title: "Task 2: Job Satisfaction vs Salary [cite: 5190]",
        qa: [
            { q: "Which is more important?", a: "High salary is needed for living expenses (food, housing). Satisfaction is needed to be happy/avoid stress.\nConclusion: Both are important. [cite: 5199-5211]" }
        ]
    },
    'wt2_single': {
        title: "Task 2: Single Life [cite: 6042]",
        qa: [
            { q: "Causes and Effects of Single Life.", a: "Causes: Avoid conflicts, haven't met right person, fear of commitment.\nEffects: Reduce social interaction, loneliness, reduce young labor force.\nConclusion: Society should be aware. [cite: 6052-6068]" }
        ]
    },
    'wt2_childbirth': {
        title: "Task 2: Delaying Childbirth [cite: 6098]",
        qa: [
            { q: "Causes and Effects of Delaying Childbirth.", a: "Causes: Career development, cost of raising children.\nEffects: Negative health effects (women/babies), reduce labor force.\nConclusion: Tackle the issue. [cite: 6109-6124]" }
        ]
    },
    'wt2_stress': {
        title: "Task 2: Stress [cite: 6198]",
        qa: [
            { q: "Effects and Solutions for Stress.", a: "Effects: Negative feelings (drink/drugs), reduce social interaction, health problems.\nSolutions: Share with friends, do exercise, spend time with family. [cite: 6208-6227]" }
        ]
    },
    'wt2_obesity': {
        title: "Task 2: Obesity [cite: 6448]",
        qa: [
            { q: "Causes and Solutions for Obesity.", a: "Causes: Unhealthy diet (fast food), lack of exercise (sitting all day).\nSolutions: Parents cook healthy food, encourage outdoor sports. [cite: 6457-6478]" }
        ]
    },
    'wt2_brain': {
        title: "Task 2: Brain Drain [cite: 6619]",
        qa: [
            { q: "Causes and Solutions for Brain Drain.", a: "Causes: Search for higher income/better standard of living abroad, better education systems.\nSolutions: Govt invest in facilities/transport, improve education, create jobs. [cite: 6627-6645]" }
        ]
    },
    'wt2_traffic': {
        title: "Task 2: Traffic Problems [cite: 6667]",
        qa: [
            { q: "Problems and Solutions.", a: "Problems: Traffic jams (rush hour), accidents.\nSolutions: Expand streets, ban cars/trucks in certain hours, speed cameras. [cite: 6670-6683]" }
        ]
    },
    'wt2_softskills': {
        title: "Task 2: Soft Skills [cite: 6583]",
        qa: [
            { q: "Ways to develop emotional/social skills.", a: "1. Take part in club activities/volunteer work (social network).\n2. Read books about emotion control/social skills.\nConclusion: Do both. [cite: 6589-6602]" }
        ]
    }
}; };

        // --- 2. H√ÄM CHUY·ªÇN M√ÄN H√åNH ---
        function enterApp() {
            document.getElementById('welcome-screen').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('welcome-screen').style.display = 'none';
                document.getElementById('app-interface').style.display = 'flex';
                document.getElementById('app-interface').style.opacity = '1';
                loadLesson('sp1_hobbies');
            }, 800);
        }

        // --- 3. H√ÄM T·∫¢I B√ÄI H·ªåC ---
        function loadLesson(key, btn) {
            if(btn) {
                document.querySelectorAll('.menu-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
            }

            const data = lessons[key];
            const contentDiv = document.getElementById('lesson-content');
            
            let html = `<div class="lesson-title">${data.title}</div>`;
            
            data.qa.forEach((item, index) => {
                html += `
                    <div class="qa-card">
                        <div class="question">C√¢u ${index + 1}: ${item.q}</div>
                        
                        <div class="user-input-area">
                            <textarea id="input-${index}" placeholder="Nh·∫≠p c√¢u tr·∫£ l·ªùi c·ªßa b·∫°n v√†o ƒë√¢y ƒë·ªÉ m√°y ch·∫•m ƒëi·ªÉm..."></textarea>
                        </div>
                        
                        <div style="margin-bottom: 10px;">
                            <button class="btn-grade" onclick="gradeAnswer(${index}, \`${escapeHtml(item.a)}\`)">
                                <i class="fas fa-check-circle"></i> Ch·∫•m b√†i ngay
                            </button>
                            <button class="btn-toggle" onclick="toggleAnswer(this)">
                                <i class="fas fa-eye"></i> Xem ƒë√°p √°n m·∫´u
                            </button>
                        </div>

                        <div id="result-${index}" class="grading-result"></div>

                        <div class="answer">${item.a}</div>
                    </div>
                `;
            });
            contentDiv.innerHTML = html;
        }

        function escapeHtml(text) {
            return text.replace(/"/g, "&quot;").replace(/'/g, "&#039;");
        }

        function toggleAnswer(btn) {
            const answerDiv = btn.parentElement.nextElementSibling.nextElementSibling; // Nh·∫£y qua div result
            if (answerDiv.classList.contains('show')) {
                answerDiv.classList.remove('show');
                btn.innerHTML = '<i class="fas fa-eye"></i> Xem ƒë√°p √°n m·∫´u';
            } else {
                answerDiv.classList.add('show');
                btn.innerHTML = '<i class="fas fa-eye-slash"></i> ·∫®n ƒë√°p √°n';
            }
        }

        // --- 4. THU·∫¨T TO√ÅN CH·∫§M ƒêI·ªÇM TH√îNG MINH (KEYWORD MATCHING) ---
        function gradeAnswer(index, sampleAnswer) {
            const userInput = document.getElementById(`input-${index}`).value.trim();
            const resultDiv = document.getElementById(`result-${index}`);
            
            if (!userInput) {
                alert("B·∫°n ch∆∞a nh·∫≠p c√¢u tr·∫£ l·ªùi!");
                return;
            }

            // 1. X·ª≠ l√Ω b√†i m·∫´u ƒë·ªÉ l·∫•y t·ª´ kh√≥a (B·ªè t·ª´ n·ªëi common)
            const stopWords = ["the", "is", "a", "an", "to", "and", "of", "in", "it", "so", "that", "my", "i", "do", "are"];
            const cleanSample = sampleAnswer.toLowerCase().replace(/[.,\/#!$%\^&\*;:{}=\-_`~()]/g,"");
            const sampleWords = cleanSample.split(/\s+/);
            
            // L·ªçc ra keywords (nh·ªØng t·ª´ > 2 k√Ω t·ª± v√† kh√¥ng n·∫±m trong stopWords)
            const keywords = new Set(sampleWords.filter(w => w.length > 2 && !stopWords.includes(w)));
            
            // 2. X·ª≠ l√Ω b√†i l√†m c·ªßa user
            const cleanInput = userInput.toLowerCase().replace(/[.,\/#!$%\^&\*;:{}=\-_`~()]/g,"");
            const inputWords = new Set(cleanInput.split(/\s+/));

            // 3. So s√°nh
            let matchCount = 0;
            let missingWords = [];
            
            keywords.forEach(word => {
                if (inputWords.has(word)) {
                    matchCount++;
                } else {
                    missingWords.push(word);
                }
            });

            // 4. T√≠nh ƒëi·ªÉm
            const totalKeywords = keywords.size;
            const score = Math.round((matchCount / totalKeywords) * 100);
            
            // 5. Hi·ªÉn th·ªã k·∫øt qu·∫£
            let feedback = "";
            let color = "";
            
            if (score >= 80) {
                feedback = "Tuy·ªát v·ªùi! B·∫°n ƒë√£ n·∫Øm r·∫•t ch·∫Øc c√°c √Ω ch√≠nh v√† t·ª´ v·ª±ng quan tr·ªçng. üåü";
                color = "#27ae60"; // Green
                resultDiv.style.background = "#d4edda";
                resultDiv.style.borderColor = "#c3e6cb";
            } else if (score >= 50) {
                feedback = "Kh√° t·ªët. B·∫°n ƒë√£ c√≥ c√°c √Ω ch√≠nh, nh∆∞ng h√£y c·ªë g·∫Øng d√πng th√™m c√°c t·ª´ v·ª±ng chuy√™n m√¥n h∆°n nh√©. üëç";
                color = "#e67e22"; // Orange
                resultDiv.style.background = "#fff3cd";
                resultDiv.style.borderColor = "#ffeeba";
            } else {
                feedback = "C·∫ßn c·ªë g·∫Øng h∆°n. B√†i vi·∫øt c·ªßa b·∫°n c√≤n thi·∫øu kh√° nhi·ªÅu t·ª´ kh√≥a quan tr·ªçng c·ªßa b√†i m·∫´u. üí™";
                color = "#c0392b"; // Red
                resultDiv.style.background = "#f8d7da";
                resultDiv.style.borderColor = "#f5c6cb";
            }

            // Ch·ªçn ra t·ªëi ƒëa 5 t·ª´ kh√≥a b·ªã thi·∫øu ƒë·ªÉ g·ª£i √Ω
            const suggestedWords = missingWords.slice(0, 7).join(", ");

            resultDiv.style.display = "block";
            resultDiv.innerHTML = `
                <div class="score-display" style="color: ${color}">ƒê·ªô kh·ªõp t·ª´ kh√≥a: ${score}%</div>
                <div class="feedback-text">${feedback}</div>
                ${suggestedWords ? `<div style="margin-top:10px; font-size:0.9rem;">
                    <strong>üí° G·ª£i √Ω b·ªï sung c√°c t·ª´ sau:</strong> 
                    <span class="missing-keywords">${suggestedWords}</span>, ...
                </div>` : ''}
            `;
        }

        // --- 5. TIMER ---
        let timeLeft = 1500; let timerId = null;
        function startTimer() { if(!timerId) timerId = setInterval(() => { timeLeft > 0 ? (timeLeft--, updateTimer()) : clearInterval(timerId); }, 1000); }
        function resetTimer() { clearInterval(timerId); timerId = null; timeLeft = 1500; updateTimer(); }
        function updateTimer() { document.getElementById('timer').innerText = `${Math.floor(timeLeft/60).toString().padStart(2,'0')}:${(timeLeft%60).toString().padStart(2,'0')}`; }
    </script>
</body>
</html>
